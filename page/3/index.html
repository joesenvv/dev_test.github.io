<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>wudaijun's blog | Coding is Funny</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">wudaijun's blog</h1><a id="logo" href="/.">wudaijun's blog</a><p class="description">Coding is Funny</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="请输入关键字..."></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h2 class="post-title"><a href="/2016/09/go-notes-2-procedural-programming/">Go 笔记(2) 顺序编程</a></h2><div class="post-meta"><p><span class="date">2016-09-09</span><span><a href="/categories/go/" class="category">go</a></span></p></div><div class="post-content"><h2 id="不定参数-amp-多返回值"><a href="#不定参数-amp-多返回值" class="headerlink" title="不定参数&amp;多返回值"></a>不定参数&amp;多返回值</h2><p>不定参数只能是最后一个参数，它实际上是数组切片参数的语法糖：</p></div><p class="readmore"><a href="/2016/09/go-notes-2-procedural-programming/">阅读更多</a></p></div><div class="post"><h2 class="post-title"><a href="/2016/09/go-notes-3-object-oriented/">Go 笔记(3) 面向对象和接口</a></h2><div class="post-meta"><p><span class="date">2016-09-09</span><span><a href="/categories/go/" class="category">go</a></span></p></div><div class="post-content"><p>探索Go类型扩展，类和继承，以及接口的用法和实现。</p></div><p class="readmore"><a href="/2016/09/go-notes-3-object-oriented/">阅读更多</a></p></div><div class="post"><h2 class="post-title"><a href="/2016/09/go-notes-1-datastructures/">Go 笔记(1) 常用数据结构及实现</a></h2><div class="post-meta"><p><span class="date">2016-09-09</span><span><a href="/categories/go/" class="category">go</a></span></p></div><div class="post-content"><p>学习一下go中常用的几种数据结构，结合源码了解其实现原理。</p></div><p class="readmore"><a href="/2016/09/go-notes-1-datastructures/">阅读更多</a></p></div><div class="post"><h2 class="post-title"><a href="/2016/08/linux-job-control/">Linux 作业管理</a></h2><div class="post-meta"><p><span class="date">2016-08-30</span><span><a href="/categories/os/" class="category">os</a></span></p></div><div class="post-content"><h3 id="进程组-会话"><a href="#进程组-会话" class="headerlink" title="进程组/会话"></a>进程组/会话</h3><p>简要概念：</p>
<ul>
<li>进程组：N(N&gt;=1)个进程的集合，通常在同一作业中关联起来(通过管道)。进程组的ID(PGID)即为进程组组长的PID。进程必定且只能属于一个进程组，只有进程组中一个进程存在，进程组就存在，与组长进程终止与否无关。进程组的概念提出主要是为了进程管理与信号分发</li>
<li>会话：N(N&gt;=1)个进程组的集合，创建会话的进程叫会话首进程。会话ID即为会话首进程PID</li>
<li>控制终端：如果会话有控制终端，建立与控制终端连接的会话首进程叫控制进程(通常就是Shell进程)，当前与终端交互的进程组为前台进程组，其余进程组成为后台进程组</li>
<li>无论合适输入终端的退出键，都会将退出信号发送到前台进程组的所有进程</li>
<li>如果控制终端断开连接，则将挂掉信号(SIGHUP)发送至控制进程(会话首进程)，SIGHUP信号默认将导致控制进程终止</li>
</ul></div><p class="readmore"><a href="/2016/08/linux-job-control/">阅读更多</a></p></div><div class="post"><h2 class="post-title"><a href="/2016/08/gs-design-concept/">一些GS设计理念</a></h2><div class="post-meta"><p><span class="date">2016-08-15</span><span><a href="/categories/gameserver/" class="category">gameserver</a></span></p></div><div class="post-content"><p>关于GS设计的一些体会，纯属个人理解。</p>
<h2 id="一-系统结构"><a href="#一-系统结构" class="headerlink" title="一. 系统结构"></a>一. 系统结构</h2><p>解耦是在做系统设计时，最应该铭记于心的原则，解耦的目的是让<strong>系统组件可以独立变化</strong>，构建易于理解，测试，维护的系统。</p>
<p>解耦的手段通常有如下几种：</p>
<h3 id="1-依赖倒置"><a href="#1-依赖倒置" class="headerlink" title="1. 依赖倒置"></a>1. 依赖倒置</h3><p>依赖倒置的原则：上层模块不应该依赖于下层模块，它们共同依赖于一个抽象。抽象不能依赖于具象，具象依赖于抽象。</p>
<p><a href="https://zh.wikipedia.org/wiki/%E4%BE%9D%E8%B5%96%E5%8F%8D%E8%BD%AC%E5%8E%9F%E5%88%99" target="_blank" rel="external">依赖倒置</a>原则的目的是把高层次组件从对低层次组件的依赖中解耦出来，这样使得重用不同层级的组件实现变得可能。如模块A依赖于模块B，那么在A和B之间加一层接口(interface)，A调用(依赖)该接口，B实现(依赖)该接口，这样，只要接口稳定，A，B即可独立变化。</p>
<p>这种依赖抽象的思想，在GOF的设计模式中，有大量宝贵实践，如策略模式，模板方法模式等。</p></div><p class="readmore"><a href="/2016/08/gs-design-concept/">阅读更多</a></p></div><div class="post"><h2 class="post-title"><a href="/2016/08/web-get-started/">web 初学笔记</a></h2><div class="post-meta"><p><span class="date">2016-08-02</span><span><a href="/categories/web/" class="category">web</a></span></p></div><div class="post-content"><p>一些简单的web学习笔记，用于在需要时快速搭建一个可用的网站。</p>
<h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><ul>
<li>HTML: 通过一套标记标签，定义网页的内容</li>
<li>CSS:  通过选择器和层叠次序，定义网页的布局</li>
<li>JavaScript: 通过可编程的文档对象模型(DOM)和事件响应，定义网页的行为</li>
</ul></div><p class="readmore"><a href="/2016/08/web-get-started/">阅读更多</a></p></div><div class="post"><h2 class="post-title"><a href="/2016/07/monitor-mongodb/">MongoDB 状态监控</a></h2><div class="post-meta"><p><span class="date">2016-07-05</span><span><a href="/categories/database/" class="category">database</a></span></p></div><div class="post-content"><h2 id="一-关键指标"><a href="#一-关键指标" class="headerlink" title="一. 关键指标"></a>一. 关键指标</h2><ul>
<li>慢查询：当MongoDB处理能力不足时，找出系统中的慢查询，分析原因，看能否通过建立索引或重新设计schema改进</li>
<li>内存使用：MongoDB吃内存(特别是MMAPv1)，至少要给MongoDB足够的内存存放索引，最理想的情况是能够存放所有数据。当内存占用过高，或者page faults过高时，考虑能不能给MongoDB预留更多的内存。</li>
<li>磁盘占用：特别是对于MMAPv1，涉及到磁盘占用的因素有很多，不合理的schema(文档频繁移动)或集合/文档的删除都可能会导致磁盘空间利用不足。前期需要设计好schema，后期维护也需要定期整理磁盘数据。</li>
<li>连接数：MongoDB为每个连接分配一个线程，因此连接是占资源的，并且也不是越多连接越好。合理地控制连接数。</li>
<li>索引不命中：查看所有查询的索引不命中情况，尽量让所有查询都通过索引</li>
<li>锁等待：锁等待的原因有很多，连接数过多，操作频繁，慢操作，schema设计过于反范式化等，可从上面的原因针对性解决。</li>
</ul></div><p class="readmore"><a href="/2016/07/monitor-mongodb/">阅读更多</a></p></div><div class="post"><h2 class="post-title"><a href="/2016/06/virtual-memory/">虚拟存储器</a></h2><div class="post-meta"><p><span class="date">2016-06-30</span><span><a href="/categories/os/" class="category">os</a></span></p></div><div class="post-content"><p>前几天又翻了翻《深入理解计算机系统》，相比几年前刚看这本书有了更多的理解，这也许就是一本好书的价值吧。因此尝试提炼和总结出对自己有用的东西，把书读薄。其中也加了一些自己的理解和查阅的相关资料。</p>
<h2 id="虚拟存储器的意义"><a href="#虚拟存储器的意义" class="headerlink" title="虚拟存储器的意义"></a>虚拟存储器的意义</h2><p>虚拟存储器提供了三个重要的能力：</p>
<ul>
<li>将主存看作是存储在磁盘上的高速缓存，并根据需要在磁盘和主存中传送数据，高效地运用主存</li>
<li>为每个进程提供一致性的地址空间，简化了存储器管理</li>
<li>保护每个进程的地址空间不被其它进程破坏</li>
</ul>
<p>下面分别从这三个方面来谈虚拟存储器</p></div><p class="readmore"><a href="/2016/06/virtual-memory/">阅读更多</a></p></div><div class="post"><h2 class="post-title"><a href="/2016/06/mongodb-storage-engine/">MongoDB 存储引擎</a></h2><div class="post-meta"><p><span class="date">2016-06-25</span><span><a href="/categories/database/" class="category">database</a></span></p></div><div class="post-content"><p>MongoDB目前支持三种存储引擎：MMAPv1 Storage Engine，In-Memory Storage Engine, WiredTiger Storage Engine。</p>
<h2 id="MMAPv1-Storage-Engine"><a href="#MMAPv1-Storage-Engine" class="headerlink" title="MMAPv1 Storage Engine"></a>MMAPv1 Storage Engine</h2><p>MongoDB3.2之前版本的默认引擎。</p>
<h3 id="1-存储原理"><a href="#1-存储原理" class="headerlink" title="1. 存储原理"></a>1. 存储原理</h3><p>文档在磁盘中连续存放，文档所占用的磁盘空间包括文档数据所占空间和文档填充(padding)。</p>
<p><img src="/assets/image/mongodb/MMAPv1_storage_engine.png" alt=""></p>
<p>摘自：MongoDB MMAPv1内部实现：<a href="http://www.mongoing.com/archives/1484" target="_blank" rel="external">http://www.mongoing.com/archives/1484</a></p></div><p class="readmore"><a href="/2016/06/mongodb-storage-engine/">阅读更多</a></p></div><div class="post"><h2 class="post-title"><a href="/2016/06/mongodb-read-write/">MongoDB 读写要点</a></h2><div class="post-meta"><p><span class="date">2016-06-23</span><span><a href="/categories/database/" class="category">database</a></span></p></div><div class="post-content"><h2 id="一-查询"><a href="#一-查询" class="headerlink" title="一. 查询"></a>一. 查询</h2><h3 id="1-1-“多段式”查询"><a href="#1-1-“多段式”查询" class="headerlink" title="1.1 “多段式”查询"></a>1.1 “多段式”查询</h3><p>当执行find操作的时候，只是返回一个游标，并不立即查询数据库，这样在执行之前可以给查询附加额外选项。几乎所有游标对象的方法都返回游标本身，因此可以按任意顺序组成方法链。以下查询是等价的：</p>
<pre><code>&gt; var cursor = db.foo.find().sort({&quot;x&quot;:1}).limit(1).skip(10)
&gt; var cursor = db.foo.find().limit(1).sort({&quot;x&quot;:1}).skip(10)
&gt; var cursor = db.foo.find().skip(10).limit(1).sort({&quot;x&quot;:1})
</code></pre><p>此时，我们只是构造了一个查询，并没有执行实际操作，当我们执行：</p>
<pre><code>&gt; cursor.hasNext()
</code></pre><p>这时，查询被发往服务器，sell立即获取第一个块(前101个文档或前1M数据，取其小者)，这样下次调用next或hasNext时，就不必再次向服务器发起一次查询。客户端用完了第一组结果，shell会再次向服务器获取下一组结果(大小不超过4MB)， 直至结果全部返回。可通过<a href="https://docs.mongodb.com/manual/reference/method/cursor.batchSize/#cursor.batchSize" target="_blank" rel="external">batchSize</a>设置游标返回的块的文档数量。</p>
<p>注：如果在shell中，没有将返回的游标赋给一个var，shell将自动迭代游标20次，显示出前20调记录。</p></div><p class="readmore"><a href="/2016/06/mongodb-read-write/">阅读更多</a></p></div><nav class="page-navigator"><a class="extend prev" rel="prev" href="/page/2/">上一页</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/4/">下一页</a></nav></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/01/go-interface-implement/">Go Interface实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/go-scheduler/">Go 调度模型</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/gc-study/">常见GC算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/hexo-with-mathjax/">Hexo使用mathjax渲染公式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/docker-network/">docker 网络模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/ngs-battle/">探讨服务端回合制战斗系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/go-conetxt-usage/">用context库规范化Go的异步调用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/go-vs-erlang/">Go vs Erlang</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/erlang-lua-reconstruction/">Erlang+Lua的一次重构</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/lua-notes/">Lua 闭包 环境 包管理</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/c-c/">c/c++</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/">database</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/erlang/">erlang</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gameserver/">gameserver</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/go/">go</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/lua/">lua</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/network/">network</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/os/">os</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/system/">system</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tool/">tool</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/unity/">unity</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><span class="category-list-count">2</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/other/" style="font-size: 15px;">other</a> <a href="/tags/ngserver/" style="font-size: 15px;">ngserver</a> <a href="/tags/lua/" style="font-size: 15px;">lua</a> <a href="/tags/skynet/" style="font-size: 15px;">skynet</a> <a href="/tags/erlang/" style="font-size: 15px;">erlang</a> <a href="/tags/firefly/" style="font-size: 15px;">firefly</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/tool/" style="font-size: 15px;">tool</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/kbengine/" style="font-size: 15px;">kbengine</a> <a href="/tags/distribution/" style="font-size: 15px;">distribution</a> <a href="/tags/unity/" style="font-size: 15px;">unity</a> <a href="/tags/tcp-ip/" style="font-size: 15px;">tcp/ip</a> <a href="/tags/c-c/" style="font-size: 15px;">c/c++</a> <a href="/tags/os/" style="font-size: 15px;">os</a> <a href="/tags/mongodb/" style="font-size: 15px;">mongodb</a> <a href="/tags/gameserver/" style="font-size: 15px;">gameserver</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/go/" style="font-size: 15px;">go</a> <a href="/tags/goa/" style="font-size: 15px;">goa</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/system/" style="font-size: 15px;">system</a> <a href="/tags/macosx/" style="font-size: 15px;">macosx</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/gc/" style="font-size: 15px;">gc</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">三月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">二月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">一月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">十二月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">十一月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">十月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">九月 2014</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">wudaijun.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/totop.js?v=2.0.1" async></script></body></html>